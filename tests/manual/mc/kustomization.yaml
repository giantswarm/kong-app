apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: d9gr8 # the id of your cluster (or org-namespace)

resources:
- app.yaml

generatorOptions:
  disableNameSuffixHash: true

configMapGenerator:
- name: kong-app-userconfig
  namespace: d9gr8
  files:
    - values=enterprise-values.yaml
- name: kong-app-upgrade-values
  namespace: d9gr8
  files:
    - values=upgrade-values.yaml

# patches:
# - target:
#    kind: App
#   patch: |-
#     - op: replace
#       path: /spec/version
#       value: 2.14.0

patches:
- target:
    kind: App
  patch: |-
    - op: replace
      path: /spec/catalog
      value: giantswarm-test
    - op: replace
      path: /spec/version
      value: 2.14.0-57242a02803ff503b6d2a340ac86825cad4fba22
    - op: add
      path: /spec/extraConfigs
      value:
        - kind: configMap
          name: kong-app-upgrade-values
          namespace: d9gr8
          priority: 110
